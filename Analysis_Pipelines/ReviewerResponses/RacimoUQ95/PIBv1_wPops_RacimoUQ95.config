//General parameters for nextflow execution:
process.executor = "slurm"
process.clusterOptions = '--requeue'
//SLURM general submission options:
executor {
   queueSize = 300
   submitRateLimit = '100/5min'
}

//Input parameters for the pipeline:
//Directory for final outputs:
params.run_name = "PIBv1_wPops"
params.run_dir_id = "PIBv1"
params.output_prefix = "/gpfs/gibbs/pi/tucci/pfr8/Friedlaender/AnalysisFreezes"
params.output_dir = "${params.output_prefix}/${params.run_dir_id}_ReviewerResponses/RacimoUQ95"

//Glob for the per-chromosome modern VCFs:
params.modern_vcf_glob = "${params.output_dir}/modern_VCFs/*.vcf.gz"
//Regex for parsing the chromosome out of the VCF name:
params.modern_vcf_regex = ~/_chr(\p{Alnum}+)/

//Glob for the per-chromosome archaic VCFs:
params.arc_vcf_glob = "${params.output_dir}/archaic_VCFs/*.vcf.gz"
//Regex for parsing the chromosome out of the VCF name:
params.arc_vcf_regex = ~/_chr(\p{Alnum}+)/

//AA tag header:
params.aa_header = "${params.output_dir}/AA_header.txt"

//Path to modern sample population map:
params.modern_pop_map = "${params.output_dir}/${params.run_dir_id}_pop_map.tsv"
//Path to archaic sample population map:
params.arc_pop_map = "${params.output_dir}/RacimoV_Archaic_pop_map.tsv"

//Use population/analysis group labels instead of regions?:
params.usepop = "1"
//Populations to exclude from AF calculations:
params.pops_to_exclude = ""

//File listing U/Q95 scan parameters:
params.UQ95_scan_params = "${params.output_dir}/${params.run_name}_UQ95_scan_params.tsv"

//U/Q95 window size:
params.window_size = "40000"

//Debugging options:
trace {
   enabled = true
   fields = 'task_id,name,hash,status,exit,cpus,memory,time,submit,start,complete,duration,%cpu,%mem,peak_rss,workdir'
   file = "${params.output_dir}/${params.run_name}_RacimoUQ95_nextflow_trace.txt"
   raw = true
   overwrite = true
}

//Reference-related parameters for the pipeline:
profiles {
   hs37d5 {
      //List of autosomes to use:
      params.autosomes = "1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22"
      //Ancestral allele FASTA glob:
      params.anc_glob = "/gpfs/gibbs/pi/tucci/pfr8/human_ancestor/hmmix/hg19_ancestral/homo_sapiens_ancestor_*.fa"
      //Ancestral allele FASTA regex:
      params.anc_regex = ~/^homo_sapiens_ancestor_(\p{Alnum}+)$/
   }

   mccleary {
      params.mod_bcftools = "bcftools/f2d2fdf"
      params.mod_htslib = "htslib/c1634e7"
   }
}

//SLURM submission parameters:
//Memory specified in GiB unless otherwise indicated
//AA FASTA reformat (aachr):
params.aachr_cpus = 1
params.aachr_mem = 1
params.aachr_mem_increment = 4
params.aachr_timeout = '1h'
params.aachr_retry_timeout = '4h'
params.aachr_queue = 'day'
params.aachr_retry_queue = 'day'
//Extract archaic present sites (arcpresent):
params.arcpresent_cpus = 1
params.arcpresent_mem = 1
params.arcpresent_mem_increment = 4
params.arcpresent_timeout = '1h'
params.arcpresent_retry_timeout = '4h'
params.arcpresent_queue = 'day'
params.arcpresent_retry_queue = 'day'
//Extract archaic derived sites (yzone):
params.yzone_cpus = 1
params.yzone_mem = 1
params.yzone_mem_increment = 4
params.yzone_timeout = '2h'
params.yzone_retry_timeout = '6h'
params.yzone_queue = 'day'
params.yzone_retry_queue = 'day'
//Concatenate sites across archaic origins (arcconcat):
params.arcconcat_cpus = 1
params.arcconcat_mem = 1
params.arcconcat_mem_increment = 4
params.arcconcat_timeout = '1h'
params.arcconcat_retry_timeout = '4h'
params.arcconcat_queue = 'day'
params.arcconcat_retry_queue = 'day'
//Extract modern genotypes at archaic derived sites (extractyzone):
params.extractyzone_cpus = 1
params.extractyzone_mem = 1
params.extractyzone_mem_increment = 4
params.extractyzone_timeout = '1h'
params.extractyzone_retry_timeout = '4h'
params.extractyzone_queue = 'day'
params.extractyzone_retry_queue = 'day'
//Construct table of modern and archaic allele frequencies (joinwxyz):
params.joinwxyz_cpus = 1
params.joinwxyz_mem = 4
params.joinwxyz_mem_increment = 4
params.joinwxyz_timeout = '1h'
params.joinwxyz_retry_timeout = '4h'
params.joinwxyz_queue = 'day'
params.joinwxyz_retry_queue = 'day'
//Evaluate U and Q95 statistics (evaluq):
params.evaluq_cpus = 1
params.evaluq_mem = 1
params.evaluq_mem_increment = 4
params.evaluq_timeout = '1h'
params.evaluq_retry_timeout = '4h'
params.evaluq_queue = 'day'
params.evaluq_retry_queue = 'day'
//Concatenate the U and Q95 statistic outputs (cat_outs):
params.cat_outs_cpus = 1
params.cat_outs_mem = 2
params.cat_outs_mem_increment = 4
params.cat_outs_timeout = '1h'
params.cat_outs_retry_timeout = '4h'
params.cat_outs_queue = 'day'
params.cat_outs_retry_queue = 'day'
